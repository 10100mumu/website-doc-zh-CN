# 数据表格

## 表格描述

结构说明:

| 字段    | 类型                         | 说明                                                                                                                                 | 必填 |
| ------- | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | ---- |
| name    | String                       | 数据表格名称                                                                                                                         | 是   |
| version | String                       | 版本号，用于依赖关系校验和开发平台呈现                                                                                               | 是   |
| bind    | Object Bind                  | 绑定数据模型。                                                                                                                       | 否   |
| apis    | \[key:String\]:Object API    | 数据管理 API 设置。如设置绑定数据模型，自动根据模型信息生成数据管理 API， 可通过设置同 `key` 的配置信息，覆盖自动生成的 API。        | 否   |
| columns | \[key:String\]:Object Column | 字段呈现方式设置。 如设置绑定数据模型，自动根据字段类型信息设置关联组件，可通过设置同 `key` 的配置信息，覆盖自动生成的关联组件信息。 | 否   |
| filters | \[key:String\]:Object Filter | 查询过滤器设置。 如设置绑定数据模型，自动根据索引和字段信息设置关联组件，可通过设置同 `key` 的配置信息，覆盖自动生成的关联组件信息。 | 否   |
| list    | Object Page                  | 列表页设置。                                                                                                                         | 是   |
| edit    | Object Page                  | 编辑页设置。                                                                                                                         | 是   |

Object bind:

| 字段  | 类型                       | 说明                  | 必填项 |
| ----- | -------------------------- | --------------------- | ------ |
| model | String                     | 绑定数据模型名称      | 是     |
| withs | \[key:String\]:Object With | 数据模型关联查询设置. | 否     |

Object API:

| 字段    | 类型         | 说明                                                                                    | 必填项 |
| ------- | ------------ | --------------------------------------------------------------------------------------- | ------ |
| process | String       | 绑定处理器 (`process`) 输入输出数据结构需与原接口保持一致                               | 是     |
| guard   | String       | 接口鉴权中间件, 多个用 `,` 分割， 设置为 `-` 不设置鉴权中间件, 不设置继承默认鉴权方式。 | 否     |
| default | Array\<Any\> | 参数表默认值, 如没有默认值可以设置为 `null`, 如 `[null, null, 15]`                      | 否     |

Object Column:

| 字段  | 类型          | 说明                                                          | 必填项 |
| ----- | ------------- | ------------------------------------------------------------- | ------ |
| label | String        | 字段呈现的字段名称                                            | 是     |
| view  | Object Render | 列表或查看页面，阅读状态时的使用的组件及属性, 默认为 `label`  | 否     |
| edit  | Object Render | 列表或查看页面，编辑状态时的使用的组件及属性 , 默认为 `input` | 否     |
| form  | Object Render | 编辑页面，使用的组件及属性，默认为 `input`                    | 否     |

Object Filter:

| 字段  | 类型          | 说明                                                                                         | 必填项 |
| ----- | ------------- | -------------------------------------------------------------------------------------------- | ------ |
| label | String        | 过滤器显示名称                                                                               | 是     |
| bind  | String        | 绑定的查询条件 URL Query String 字段名称, 如 `where.manu_id.in` (用作 `search` API 查询参数) | 是     |
| input | Object Render | 查询内容输入组件, 默认为 `input`                                                             | 否     |

Object Page:

| 字段  | 类型          | 说明                                                          | 必填项 |
| ----- | ------------- | ------------------------------------------------------------- | ------ |
| label | String        | 字段呈现的字段名称                                            | 是     |
| view  | Object Render | 列表或查看页面，阅读状态时的使用的组件及属性, 默认为 `label`  | 否     |
| edit  | Object Render | 列表或查看页面，编辑状态时的使用的组件及属性 , 默认为 `input` | 否     |
| form  | Object Render | 编辑页面，使用的组件及属性，默认为 `input`                    | 否     |

Object Render:

| 字段       | 类型          | 说明                                                                                       | 必填项 |
| ---------- | ------------- | ------------------------------------------------------------------------------------------ | ------ |
| type       | String        | 使用的组件名称 [查看支持的组件](https://github.com/YaoApp/sheng)                           | 是     |
| props      | Object\<Any\> | 组件属性，具体查看对应组件文档。属性参数中可以使用 `字符串`、`数字` 和 `变量`。            | 否     |
| components | Array\<Any\>  | 复合组件，引用原子组件名称或描述。 `["计费方式", "行业覆盖", {"name":"姓名", "props":{}}]` | 否     |

### 基本使用

### 关联查询

## API 接口

## 处理器

## 场景示例

### 关联查询

[查看完整示例代码](https://github.com/YaoApp/examples-zh-CN/tree/main/tables/remote-select)

#### 数据模型

厂商模型 `manu`

| 字段 | 标签 |
| ---- | ---- |
| id   | ID   |
| name | 名称 |

数据示例

| ID  | 名称     |
| --- | -------- |
| 1   | 象传智慧 |
| 2   | 云道天成 |

模型描述

```json
{
  "name": "厂商",
  "table": { "name": "manu", "comment": "渠道表", "engine": "InnoDB" },
  "columns": [
    {
      "label": "ID",
      "name": "id",
      "type": "ID",
      "comment": "ID"
    },
    {
      "label": "名称",
      "name": "name",
      "type": "string",
      "comment": "厂商名称"
    }
  ]
}
```

用户模型 `user`

| 字段    | 标签                      |
| ------- | ------------------------- |
| ID      | id                        |
| manu_id | 厂商 ID `关联厂商 hasOne` |
| name    | 姓名                      |

数据示例

| ID  | 厂商 | 名称   |
| --- | ---- | ------ |
| 1   | 1    | 张无忌 |
| 2   | 1    | 李光富 |
| 3   | 2    | 李木婷 |
| 4   | 2    | 赵长青 |

模型描述

```json
{
  "name": "用户",
  "table": { "name": "user", "comment": "用户表", "engine": "InnoDB" },
  "columns": [
    {
      "label": "ID",
      "name": "id",
      "type": "ID",
      "comment": "ID"
    },
    {
      "label": "厂商",
      "name": "manu_id",
      "type": "bigInteger",
      "comment": "厂商ID"
    },
    {
      "label": "姓名",
      "name": "name",
      "type": "string",
      "comment": "用户姓名"
    }
  ],
  "relations": {
    "manu": {
      "type": "hasOne",
      "model": "manu",
      "key": "id",
      "foreign": "manu_id",
      "query": {}
    }
  }
}
```

#### 用户表格

实现在用户表格中下拉选择厂商

| ID  | 所属厂商 | 姓名   |
| --- | -------- | ------ |
| 1   | 象传智慧 | 张无忌 |
| 2   | 象传智慧 | 李光富 |
| 3   | 云道天成 | 李木婷 |
| 4   | 云道天成 | 赵长青 |

第一步： 列表和详情查询 API 中声明关联关系

```json
{
  "bind": {
    "model": "user",
    "withs": { "manu": {} }
  },
  "apis": {
    "search": {
      "withs": { "manu": {} },
      "default": [
        { "orders": [{ "column": "updated_at", "option": "desc" }] },
        null,
        10
      ]
    }
  }
}
```

第二步：设定关联字段使用组件

**需提前建立关联表格描述**

```json
{
  "columns": {
    "所属厂商": {
      "label": "所属厂商",
      "view": {
        "type": "label",
        "props": {
          "value": ":manu.name"
        }
      },
      "edit": {
        "type": "select",
        "props": {
          "bind": "manu.name",
          "value": ":manu_id",
          "showSearch": true,
          "useValue": true,
          "remote": {
            "api": "/api/xiang/table/manu/select",
            "query": { "select": ["name", "id"], "limit": 20 }
          },
          "search": {
            "api": "/api/xiang/table/manu/select",
            "query": { "select": ["name", "id"], "limit": 20 },
            "key": "keyword"
          }
        }
      }
    }
  }
}
```

第三步：表格字段引用

在列表中显示

```json
{
  "list": {
    "layout": {
      "columns": [
        { "name": "ID", "width": 80 },
        { "name": "所属厂商" },
        { "name": "姓名" }
      ]
    }
  }
}
```

在编辑页显示

```json
{
  "edit": {
    "primary": "id",
    "layout": {
      "fieldset": [
        {
          "columns": [
            { "name": "姓名", "width": 18 },
            { "name": "所属厂商", "width": 6 }
          ]
        }
      ]
    }
  }
}
```
