# 数据表格

## 表格描述

### 基本使用

### 关联查询

## API 接口

## 处理器

## 场景示例

### 关联查询

#### 数据模型

厂商模型 `manu`

| 字段 | 标签 |
| ---- | ---- |
| id   | ID   |
| name | 名称 |

数据示例

| ID  | 名称     |
| --- | -------- |
| 1   | 象传智慧 |
| 2   | 云道天成 |

模型描述

```json
{
  "name": "厂商",
  "table": { "name": "manu", "comment": "渠道表", "engine": "InnoDB" },
  "columns": [
    {
      "label": "ID",
      "name": "id",
      "type": "ID",
      "comment": "ID"
    },
    {
      "label": "名称",
      "name": "name",
      "type": "string",
      "comment": "厂商名称"
    }
  ]
}
```

用户模型 `user`

| 字段    | 标签                      |
| ------- | ------------------------- |
| ID      | id                        |
| manu_id | 厂商 ID `关联厂商 hasOne` |
| name    | 姓名                      |

数据示例

| ID  | 厂商 | 名称   |
| --- | ---- | ------ |
| 1   | 1    | 张无忌 |
| 2   | 1    | 李光富 |
| 3   | 2    | 李木婷 |
| 4   | 2    | 赵长青 |

模型描述

```json
{
  "name": "用户",
  "table": { "name": "user", "comment": "用户表", "engine": "InnoDB" },
  "columns": [
    {
      "label": "ID",
      "name": "id",
      "type": "ID",
      "comment": "ID"
    },
    {
      "label": "姓名",
      "name": "name",
      "type": "string",
      "comment": "用户姓名"
    }
  ],
  "relations": {
    "manu": {
      "type": "hasOne",
      "model": "manu",
      "key": "id",
      "foreign": "manu_id",
      "query": {}
    }
  }
}
```

#### 用户表格

实现在用户表格中下拉选择厂商

| ID  | 所属厂商 | 姓名   |
| --- | -------- | ------ |
| 1   | 象传智慧 | 张无忌 |
| 2   | 象传智慧 | 李光富 |
| 3   | 云道天成 | 李木婷 |
| 4   | 云道天成 | 赵长青 |

第一步： 列表和详情查询 API 中声明关联关系

```json
{
  "bind": {
    "model": "user",
    "withs": { "manu": {} }
  },
  "apis": {
    "search": {
      "withs": { "manu": {} },
      "default": [
        { "orders": [{ "column": "updated_at", "option": "desc" }] },
        null,
        10
      ]
    }
  }
}
```

第二步：设定关联字段使用组件

**需提前建立关联表格描述**

```json
{
  "columns": {
    "所属厂商": {
      "label": "所属厂商",
      "view": {
        "type": "label",
        "props": {
          "value": ":manu.name"
        }
      },
      "edit": {
        "type": "select",
        "props": {
          "bind": "manu.name",
          "value": ":manu_id",
          "showSearch": true,
          "useValue": true,
          "remote": {
            "api": "/api/table/manu/select",
            "query": { "name": "name", "value": "id", "limit": 20 }
          },
          "search": {
            "api": "/api/table/manu/select",
            "query": { "name": "name", "value": "id", "limit": 20 },
            "key": "keyword"
          }
        }
      }
    }
  }
}
```

第三步：表格字段引用

在列表中显示

```json
{
  "list": {
    "layout": {
      "columns": [
        { "name": "ID", "width": 80 },
        { "name": "所属厂商" },
        { "name": "姓名" }
      ]
    }
  }
}
```

在编辑页显示

```json
{
  "edit": {
    "primary": "id",
    "layout": {
      "fieldset": [
        {
          "columns": [
            { "name": "姓名", "width": 18 },
            { "name": "所属厂商", "width": 6 }
          ]
        }
      ]
    }
  }
}
```

#### 完整示例

厂商表格 `manu.tab.json`

```json
{
  "name": "厂商",
  "version": "1.0.0",
  "decription": "厂商管理表格",
  "bind": {
    "model": "manu"
  },
  "apis": {
    "search": { "default": [null, null, 10] }
  },
  "columns": {},
  "filters": {},
  "list": {
    "primary": "id",
    "layout": {
      "columns": [{ "name": "ID", "width": 80 }, { "name": "名称" }],
      "filters": []
    },
    "actions": {
      "pagination": {},
      "create": {
        "type": "button",
        "props": { "label": "添加厂商", "icon": "fas fa-plus" }
      }
    },
    "option": {}
  },
  "edit": {
    "primary": "id",
    "layout": {
      "fieldset": [
        {
          "columns": [{ "name": "名称", "width": 18 }]
        }
      ]
    },
    "actions": {
      "cancel": {},
      "save": { "@": "action.保存" },
      "delete": { "@": "action.删除" }
    },
    "option": {}
  },
  "insert": {},
  "view": {}
}
```

用户表格 `user.tab.json`

```json
{
  "name": "用户",
  "version": "1.0.0",
  "decription": "用户管理表格",
  "bind": {
    "model": "user",
    "withs": { "manu": {} }
  },
  "apis": {
    "search": {
      "default": [{ "withs": { "manu": {} } }, null, 10]
    }
  },
  "columns": {
    "所属厂商": {
      "label": "所属厂商",
      "view": {
        "type": "label",
        "props": {
          "value": ":manu.name"
        }
      },
      "edit": {
        "type": "select",
        "props": {
          "bind": "manu.name",
          "value": ":manu_id",
          "showSearch": true,
          "useValue": true,
          "remote": {
            "api": "/api/table/manu/select",
            "query": { "name": "name", "value": "id", "limit": 20 }
          },
          "search": {
            "api": "/api/table/manu/select",
            "query": { "name": "name", "value": "id", "limit": 20 },
            "key": "keyword"
          }
        }
      }
    }
  },
  "filters": {},
  "list": {
    "primary": "id",
    "layout": {
      "columns": [
        { "name": "ID", "width": 80 },
        { "name": "所属厂商" },
        { "name": "姓名" }
      ],
      "filters": []
    },
    "actions": {
      "pagination": { "props": { "showTotal": true } },
      "create": {
        "type": "button",
        "props": { "label": "添加用户", "icon": "fas fa-plus" }
      }
    },
    "option": {}
  },
  "edit": {
    "primary": "id",
    "layout": {
      "fieldset": [
        {
          "columns": [
            { "name": "姓名", "width": 18 },
            { "name": "所属厂商", "width": 6 }
          ]
        }
      ]
    },
    "actions": {
      "cancel": {},
      "save": { "@": "action.保存" },
      "delete": { "@": "action.删除" }
    },
    "option": { "dev": false }
  },
  "insert": {},
  "view": {}
}
```
